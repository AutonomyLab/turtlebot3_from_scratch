<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ROS Navigation Stack: Package: tsim</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ROS Navigation Stack
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Package: tsim </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Author: Maurice Rahme</p>
<h2>Package Summary</h2>
<div class="image">
<img src="../../media/traj_rect.png" alt="tsimpic"/>
</div>
<p>This package makes the turtle in turtlesim trace a rectangular trajectory while showing a plot of the absolute position error (x, y, theta) between the pure-feedforward and the actual turtle position as read from the <code>turtle1/pose</code> topic. It also has a service, <code>traj_reset</code>, which teleports the turtle back to its initial configuration whenever called.</p>
<p>A separate launchfile within this package makes the turtlesim trace a pentagon by default - although you may change the trajectory shape by updating <code>turtle_way.yaml</code> - and launches Rviz to make the <code>diff_drive</code> robot trace the same trajectory using an kinematic model. The <code>turtle_pent.launch</code> launchfile performs the turtlesim portion of this task.</p>
<p>Resultant Simulation for both launchfiles respectively:</p>
<div class="image">
<img src="../../media/traj_rect.gif" alt="tsim"/>
</div>
<div class="image">
<img src="../../media/dd_turtle.gif" alt="tsimrviz"/>
</div>
<h2>Launch Instructions</h2>
<p>To launch the <code>turtle_rect</code> node without showing the position error plot, run: <code>roslaunch tsim trect.launch</code>.</p>
<p>To launch the <code>turtle_rect</code> node while showing the position error plot, run: <code>roslaunch tsim trect.launch plot_gui:=1</code>.</p>
<p>To launch the <code>turtle_way</code> node, which traces the pentagon by default with no position error plot, run: <code>roslaunch tsim turtle_pent.launch</code>.</p>
<p>To launch the <code>turtle_way</code> node while showing the position error plot, run: <code>roslaunch tsim turtle_pent.launch plot_gui:=1</code>.</p>
<p>To launch the Rviz tracing subset of the package without the position error plot, run: <code>roslaunch tsim turtle_odom.launch</code>.</p>
<p>To launch the Rviz tracing subset of the package while showing the position error plot, run: <code>roslaunch tsim turtle_odom.launch plot_gui:=1</code>.</p>
<h2><a class="el" href="../../d9/db6/turtle__way__node_8cpp.html" title="Makes turtlesim modeled as Diff Drive robot follow a user-specified trajectory in turtle_way...">turtle_way_node.cpp</a></h2>
<p>This node uses functionality from the <code>rigid2d</code> package, namely the <code>DiffDrive</code> and <code>Waypoints</code> classes, which model a differential drive robot and actuate the waypoint following sequence respectively. It uses open-loop Proportional control with the fordward-predicted differential drive model pose as an input to the control loop, to send appropriate Twist commands to the turtlesim. The <code>poseCallback (void)</code>, position callback function subscribes to <code>turtle1/pose</code> and uses this information to create the position error plot alongside the forward-predicted differential drive model pose. Note that the Twist sent to the turtlesim is divided by the loop rate before it is fed to the differential drive model for forward propagation.</p>
<h2><a class="el" href="../../da/d60/fake__diff__encoders__node_8cpp.html" title="Main: Publishes Fake Encoder Messages to /joint_states. ">fake_diff_encoders_node.cpp</a> (rigid2d package)</h2>
<p>This node reads the Twist commanded to the turtle via the <code>cmd_vel</code> topic, divides it by the loop rate of the <code>turtle_way_node</code> node, and uses it to forward-propagate the differential drive model using <code>DiffDrive::feedforward()</code> to retrieve the resultant wheel angles from performing this twist. These are then published to the <code>/joint_states</code> topic, which Rviz reads to assign the wheel angles.</p>
<h2><a class="el" href="../../d1/de5/odometer__node_8cpp.html" title="Main: Publishes Odometry messages for diff drive robot based on wheel joint states. ">odometer_node.cpp</a> (rigid2d package)</h2>
<p>This node subscribes to <code>/joint_states</code> to get the wheel angle values from the joint state publisher, and uses these to forward-propagate the differential drive model using <code>DiffDrive::updateOdometry</code>, which also returns the resultant wheel velocities and internally updates the robot's pose. These wheel velocities are fed to <code>DiffDrive::wheelsToTwist()</code> to return the corresponding Twist of the robot. Finally, the pose and Twist retrieved from these operations are published as <code>tf2</code> frames to simulate the robot's motion in RViz.</p>
<h2><a class="el" href="../../d2/d08/turtle__rect__node_8cpp.html" title="Main: makes turtle in turtlesim move in a rectangular trajectory. ">turtle_rect_node.cpp</a></h2>
<p>This is the executable node, which initialises the node, creates a <code>Node Handle</code>, and includes the <code>TurtleRect</code> class to make the turtle in turtlesim trace a rectangular trajectory while showing a plot of the absolute position error (x, y, theta) by calling its public <code>control</code> method, making it loop indefinitely until it is interrupted.</p>
<h2><a class="el" href="../../d8/d55/turtle__rect_8cpp.html" title="Class Constructor for TurtleRect. ">turtle_rect.cpp</a></h2>
<p>This is the Class Constructor for <code>TurtleRect</code> containing the following methods:</p>
<ul>
<li><code>traj_resetCallback (bool)</code>: callback for <code>traj_reset service</code>, which teleports turtle back to initial config.</li>
<li><code>poseCallback (void)</code>: callback for <code>turtle1/pose</code> subscriber, which records the turtle's pose for use elsewhere.</li>
<li><code>move (void)</code>: helper function which publishes <code>Twist</code> messages to <code>turtle1/cmd_vel</code> to actuate the turtle.</li>
<li><code>predict(void)</code>: helper function which forward propagates the open-loop model and publishes <code>PoseError</code> to <code>pose_error</code>.</li>
<li><code>control(void)</code>: main class method. Houses state machine and calls helper function to perform trajectory and plot.</li>
</ul>
<h2>turtle_rect.h</h2>
<p>Header file for the <code>TurtleRect</code> class.</p>
<h2>trect.launch</h2>
<p>Calls the <code>roaming_turtle</code> node from <code>turtlesim</code>, as well as the <code>turtle_rect_node</code> node from this package, and gives the user an option to show the error plot using the <code>plot_gui</code> argument, which defaults to <code>False</code>.</p>
<h2>turtle_rect.yaml</h2>
<p>Contains the parameters for executing the rectangular trajectory.</p>
<ul>
<li><code>x (int)</code>: x coordinate for lower left corner of rectangle.</li>
<li><code>y (int)</code>: y coordinate for lower left corner of rectangle.</li>
<li><code>width (int)</code>: width of rectangle.</li>
<li><code>height (int)</code>: height of rectangle.</li>
<li><code>trans_vel (int)</code>: translational velocity of robot.</li>
<li><code>rot_vel (int)</code>: rotational velocity of robot.</li>
<li><code>frequency (int)</code>: frequency of control loop.</li>
<li><code>threshold (float)</code>: specifies when the target pose has been reached.</li>
</ul>
<h2>Resultant Plot for turtle_rect_node</h2>
<div class="image">
<img src="../../media/plot.png" alt="plot"/>
</div>
<p>Note that the plot increases in drift over time as the forward propagated controls would result in several superimposed but slanted rectangular trajectories (as you saw from Josh ealier today) were it not for the feedback control implemented here to stop and start the linear and angular velocity commands. The error plot hence descibres the difference between pure feedforward control and the implementation done here. Calling the <code>traj_reset</code> service resets this error to zero temporarily, before re-commencing the trajectory and ensuing in drift as seen below.</p>
<div class="image">
<img src="../../media/reset.png" alt="plot"/>
</div>
<h2>Resultant Plot for turtle_way_node</h2>
<div class="image">
<img src="../../media/plot_way.png" alt="plotway"/>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
